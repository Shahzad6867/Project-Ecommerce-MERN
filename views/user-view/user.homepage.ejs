
<%- include("../partials/user-side/navbar.ejs",{title : "Novamart - Home"})%>
    <!-- Categories -->
    <div class="bg-white shadow-sm py-2 px-4">
        <div class="max-w-7xl mx-auto flex justify-center overflow-x-auto space-x-6 py-2 hide-scrollbar">
            <% for( let i = 0; i < categories.length; i++ ) { %>
                <% if (!categories[i].isDeleted) { %>
            <a href="#" class="category whitespace-nowrap hover:text-blue-600 "><%= categories[i].categoryName %></a>
              <% } %>
            <% } %>
        </div>
    </div>

    <div class="w-full overflow-hidden relative mb-8">
        <div class="flex transition-transform duration-300 ease-in-out">
            <!-- Slide 1 -->
            <div class="min-w-full h-96 flex items-center justify-center relative">
                <img src="http://static.photos/shopping/1200x630/1" alt="Summer Sale" class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center">
                    <div class="text-center p-6 max-w-2xl mx-auto text-white">
                        <h1 class="text-4xl md:text-5xl font-bold mb-4">Summer Sale Up To 50% Off</h1>
                        <p class="text-xl mb-6">Shop the hottest deals of the season</p>
                        <button class="bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-bold py-3 px-8 rounded-full">
                            Shop Now
                        </button>
                    </div>
                </div>
            </div>
            <!-- Slide 2 -->
            <div class="min-w-full h-96 flex items-center justify-center relative">
                <img src="http://static.photos/fashion/1200x630/2" alt="New Arrivals" class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center">
                    <div class="text-center p-6 max-w-2xl mx-auto text-white">
                        <h1 class="text-4xl md:text-5xl font-bold mb-4">New Arrivals</h1>
                        <p class="text-xl mb-6">Discover our latest collection</p>
                        <button class="bg-white hover:bg-gray-100 text-red-500 font-bold py-3 px-8 rounded-full">
                            Explore
                        </button>
                    </div>
                </div>
            </div>
            <!-- Slide 3 -->
            <div class="min-w-full h-96 flex items-center justify-center relative">
                <img src="http://static.photos/electronics/1200x630/3" alt="Limited Time Offer" class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center">
                    <div class="text-center p-6 max-w-2xl mx-auto text-white">
                        <h1 class="text-4xl md:text-5xl font-bold mb-4">Limited Time Offer</h1>
                        <p class="text-xl mb-6">Don't miss out on these exclusive deals</p>
                        <button class="bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-bold py-3 px-8 rounded-full">
                            Grab Deals
                        </button>
                    </div>
                </div>
            </div>
</div>
        <!-- Navigation Dots -->
        <div class="absolute bottom-4 left-0 right-0 flex justify-center gap-2">
            <button class="w-3 h-3 rounded-full bg-white/50 hover:bg-white transition"></button>
            <button class="w-3 h-3 rounded-full bg-white/50 hover:bg-white transition"></button>
            <button class="w-3 h-3 rounded-full bg-white/50 hover:bg-white transition"></button>
        </div>
    </div>


    

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-6">
        


        <!-- Categories Grid -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold mb-6">Shop By Category</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                <% for( let i = 0; i < categories.length; i++ ) { %>
                    <% if (!categories[i].isDeleted) { %>
                <a href="#" class="category-card bg-white rounded-lg shadow-sm p-4 text-center hover:shadow-md transition-all">
                    <div class="h-32 mb-3 overflow-hidden">
                        <img src="<%= categories[i].categoryImage %>" alt="Electronics" class="w-full h-full object-contain transition-transform">
                    </div>
                    <h3 class="category"><%= categories[i].categoryName  %></h3>
                </a>    
                  <% } %>
                <% } %>
            </div>
        </section>


        <!-- Featured Products -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold mb-6">Featured Products</h2>
            <div class="scroll-x-div">
                <!-- Product Card 1 -->

                 <% for( let i = 0; i < products.length; i++ ) { %>
                    <% if (!products[i].categoryId.isDeleted && !products[i].brandId.isDeleted) { %>
                    <% if (!products[i].isDeleted) { %>
                    <% if (products[i].isFeatured) { %>
                        <% for( let j = 0; j < products[i].variants.length; j++ ) { %>
                            <% if ( products[i].variants[j].stockQuantity !== 0 && products[i].variants[j].stockStatus !== "Out of Stock" ) { %>
                                <%
                                /* ================================
                                   Base values
                                ================================ */
                                const now = new Date()
                                const price = products[i].variants[j].price
                                const productOffer = products[i].variants[j].productOfferId
                                const categoryOffer = products[i].categoryOfferId
                                
                                let offerPrice = price
                                let productOfferPrice = null
                                let categoryOfferPrice = null
                                
                                /* ================================
                                   Check offer activeness
                                ================================ */
                                const isProductOfferActive =
                                  productOffer &&
                                  productOffer.startDate <= now &&
                                  productOffer.endDate >= now
                                
                                const isCategoryOfferActive =
                                  categoryOffer &&
                                  categoryOffer.startDate <= now &&
                                  categoryOffer.endDate >= now
                                
                                /* ================================
                                   Calculate product offer price
                                ================================ */
                                if (isProductOfferActive) {
                                  if (productOffer.discountType === "percentage") {
                                    productOfferPrice =
                                      price - (price * productOffer.discountValue) / 100
                                  } else if (productOffer.discountType === "flat") {
                                    productOfferPrice =
                                      price - productOffer.discountValue
                                  }
                                }
                                
                                /* ================================
                                   Calculate category offer price
                                ================================ */
                                if (isCategoryOfferActive) {
                                  if (categoryOffer.discountType === "percentage") {
                                    const percentPrice =
                                      price - (price * categoryOffer.discountValue) / 100
                                
                                    const maxPrice =
                                      price - categoryOffer.maxDiscountAmount
                                
                                    // Apply max discount cap
                                    categoryOfferPrice = Math.max(percentPrice, maxPrice)
                                
                                  } else if (categoryOffer.discountType === "flat") {
                                    if (price > categoryOffer.productMinPrice) {
                                      categoryOfferPrice =
                                        price - categoryOffer.discountValue
                                    }
                                  }
                                }
                                
                                /* ================================
                                   Decide final offer price
                                ================================ */
                                if (productOfferPrice !== null && categoryOfferPrice !== null) {
                                  // Both active → choose better discount
                                  offerPrice = Math.min(productOfferPrice, categoryOfferPrice)
                                
                                } else if (productOfferPrice !== null) {
                                  // Only product offer active
                                  offerPrice = productOfferPrice
                                
                                } else if (categoryOfferPrice !== null) {
                                  // Only category offer active
                                  offerPrice = categoryOfferPrice
                                }
                                // Else → no active offer, original price remains
                                %>
                                
                            
                            
                <div class="product-card mr-2 bg-white rounded-lg shadow-sm p-4 transition-all w-[240px] flex-shrink-0">
                    <div class="h-40 mb-3 relative">
                        <img src="<%= products[i].variants[j].productImages[0] %>" alt="Product" class="w-full h-full object-contain">

                        <% let isProductInWishlist = wishlistItems.find(item => String(products[i]._id) === String(item.productId) && item.variant === j)%>
                       
                        <button  type="button" class="absolute top-2 right-2 bg-white rounded-full p-2 shadow-md hover:bg-gray-100" onclick="removeFromWishlist('<%= products[i]._id %>','<%= j %>')">
                            <i data-feather="heart" class="w-4 h-4" fill="#FF2400" stroke="#FF2400"></i>
                        </button>
                      
                            <button id="addWishBtn<%= products[i]._id %><%= j %>" type="button" class="absolute top-2 right-2 bg-white rounded-full p-2 shadow-md hover:bg-gray-100 <%= (isProductInWishlist) ? 'hidden' : '' %>" onclick="addToWishlist(this,'<%= products[i]._id %>','<%= j %>')">
                                <i  data-feather="heart" class="w-4 h-4" ></i>
                            </button>
                       
        
                       
                        <a href="/product?id=<%= products[i]._id %>&variant=<%= j%>">
                            <button class="absolute top-12 right-2 bg-white rounded-full p-2 shadow-md hover:bg-gray-100">
                                <i data-feather="eye" class="w-4 h-4"></i>
                            </button>
                        </a>
                    </div>
                    <h3 class="font-medium text-sm mb-1 truncate"><%= products[i].productName  %></h3>
                    <div class="flex items-center mb-1">
                        <div class="text-yellow-400 flex">
                            <i data-feather="star" class="w-4 h-4 fill-current"></i>
                            <i data-feather="star" class="w-4 h-4 fill-current"></i>
                            <i data-feather="star" class="w-4 h-4 fill-current"></i>
                            <i data-feather="star" class="w-4 h-4 fill-current"></i>
                            <i data-feather="star" class="w-4 h-4 fill-current"></i>
                        </div>
                        <span class="text-gray-500 text-xs ml-1">(4,567)</span>
                    </div>
                    <div class="flex items-center mb-2">
                        <span class="font-regular text-xs">Brand : <a href="#" class="text-blue-700"><%= (products[i].brandId.brandName) %></a></span>
                    </div>
                    <div class="flex items-center mb-2">
                        <span class="font-regular text-gray-700 text-xs">Size : <a href="#" ><%= (products[i].variants[j].size) %></a></span>
                    </div>
                    <div class="flex items-center mb-2">
                        <% if (offerPrice > 0 && offerPrice < products[i].variants[j].price ) { %>
                            <span class="font-bold text-lg">$ <span id="price<%= products[i]._id  %><%= j %>" ><%= offerPrice.toFixed(2) %></span></span>
                            <span class="text-gray-500 text-sm line-through ml-2">$<%= (products[i].variants[j].price).toFixed(2)  %></span>
                            <span class="text-green-600 text-xs font-medium ml-2"><%= (((products[i].variants[j].price - offerPrice) / products[i].variants[j].price) * 100).toFixed(0) %>% off</span>   
                        <% } else {%>
                            <span class="font-bold text-lg">$ <span id="price<%= products[i]._id %><%= j %>"><%= (products[i].variants[j].price).toFixed(2) %></span></span>
                        <% } %>

                    </div>
                    <% let isProductInCart = cartItems.find(item =>  String(products[i]._id) === String(item.productId._id) && item.variant === j ) || null %>
                    <% if (isProductInCart) { %>
                            <div class="flex  justify-between ">
                               <button type="button" id="addToCartBtn<%= products[i]._id %><%= j %>" class="w-[0%] bg-yellow-400 hover:bg-yellow-500 text-gray-900  rounded-md font-medium text-sm flex items-center justify-center" onclick="addToCartInitially(this,'<%- i %>','<%- j %>','<%- products[i]._id %>')">
                                <i data-feather="shopping-cart" class="w-4 h-4 mr-2"></i> 
                            </button>
                                <div id="incDecQtyDiv<%= products[i]._id %><%= j %>" class="flex items-center justify-between w-[100%]  rounded-lg   border border-black w-full ">
                                    <button id="decQtyBtn<%= products[i]._id %><%= j %>" type="button" class="text-center flex justify-center w-full h-full bg-yellow-400 hover:bg-yellow-300 py-1 rounded-l-lg"  onclick="decrementQuantity('<%= i %>','<%= j %>','<%= products[i]._id %>')">
                                        <i data-feather="minus"></i>
                                    </button> 
                                    <input type="text" id="quantity<%= products[i]._id %><%= j %>" value="<%= isProductInCart.quantity %>" class=" w-[5rem] px-2 text-xl bg-white font-bold py-[0.22rem] border-black-x-sides text-center" >
                                    <button id="incQtyBtn<%= products[i]._id %><%= j %>" type="button" class="text-center flex justify-center w-full h-full py-1 bg-yellow-400 hover:bg-yellow-300 rounded-r-lg"  onclick="incrementQuantity('<%= i %>','<%= j %>','<%= products[i]._id %>')">
                                        <i data-feather="plus"></i>
                                    </button>
                                </div>
                            </div>
                    <% } else {%>
                        <!-- <a  href="/home/cart?productId=&variant=&quantity=1"> -->
                            <div id="incDecQtyDiv<%= products[i]._id %><%= j %>" class="flex items-center justify-between w-[100%] bg-yellow-400  border border-black rounded-lg hidden">
                                <button id="decQtyBtn<%= products[i]._id %><%= j %>" type="button" class="text-center flex justify-center w-full h-full bg-yellow-400 hover:bg-yellow-300 py-1 rounded-l-lg" onclick="decrementQuantity('<%= i %>','<%= j %>','<%= products[i]._id %>')">
                                    <i data-feather="minus"></i>
                                </button> 
                                <input type="text" id="quantity<%= products[i]._id %><%= j %>" value="1" class=" w-[5rem] bg-white px-2 text-xl  py-[0.22rem] border-black-x-sides text-center" >
                                <button id="incQtyBtn<%= products[i]._id %><%= j %>" type="button" class="text-center flex justify-center w-full h-full py-1 bg-yellow-400 hover:bg-yellow-300 rounded-r-lg" onclick="incrementQuantity('<%= i %>','<%= j %>','<%= products[i]._id %>')">
                                    <i data-feather="plus"></i>
                                </button>
                            </div>
                            <button type="button" id="addToCartBtn<%= products[i]._id %><%= j %>" class="w-full bg-yellow-400 hover:bg-yellow-500 text-gray-900 py-2 rounded-md font-medium text-sm flex items-center justify-center" onclick="addToCartInitially(this,'<%- i %>','<%- j %>','<%- products[i]._id %>')">
                                <i data-feather="shopping-cart" class="w-4 h-4 mr-2"></i> Add to Cart
                            </button>
                            
                    <% } %>   
                </div>     
                               <% } %> 
                            <% } %>  
                           <% } %>
                         <% } %>
                     <% } %>
                 <% } %>
                <!-- More product cards... -->
            </div>
        </section>




        <!-- Hero Banner -->
        <div class="mb-8">
            <div class=" rounded-lg overflow-hidden h-64 flex items-center justify-center text-white">
                <img src="/images/iphone17pro.jpg"  alt="" class="w-full h-full object-cover">
                <div class="text-center p-6 absolute">
                    <h1 class="text-4xl font-bold mb-4">iPhone 17 Pro</h1>
                    <p class="text-xl mb-6">Shop the hottest deals of the season</p>
                    <a href="/product?id=68ec90af0a05040e993f576a&variant=0">
                        <button class="bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-bold py-3 px-8 rounded-full">
                            Shop Now
                        </button>
                    </a>
                </div>
            </div>
        </div>


        <!-- Deals Carousel -->
        <section class="mb-12">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Today's Deals</h2>
                <a href="/shop" class="text-gray-800 font-bold bg-yellow-400 hover:bg-yellow-300 px-4 py-2 rounded-full ">Shop Now</a>
            </div>
            <div class="relative">
                <div class="deals-carousel scroll-x-div">
                    <%   const now = new Date() %>
                    <% for( let i = 0; i < products.length; i++ ) { %>
                        <% if (!products[i].categoryId.isDeleted && !products[i].brandId.isDeleted) { %>
                        <% if (!products[i].isDeleted) { %>
                         <% if (!products[i].isFeatured) { %>
                        <% for( let j = 0; j < products[i].variants.length; j++ ) { %>
                           
                        <% if ( products[i].variants[j].stockQuantity !== 0 && products[i].variants[j].stockStatus !== "Out of Stock" ) { %>
                            <%
                                /* ================================
                                   Base values
                                ================================ */
                              
                                const price = products[i].variants[j].price
                                const productOffer = products[i].variants[j].productOfferId
                                const categoryOffer = products[i].categoryOfferId
                                
                                let offerPrice = price
                                let productOfferPrice = null
                                let categoryOfferPrice = null
                                
                                /* ================================
                                   Check offer activeness
                                ================================ */
                                const isProductOfferActive =
                                  productOffer &&
                                  productOffer.startDate <= now &&
                                  productOffer.endDate >= now
                                
                                const isCategoryOfferActive =
                                  categoryOffer &&
                                  categoryOffer.startDate <= now &&
                                  categoryOffer.endDate >= now
                                
                                /* ================================
                                   Calculate product offer price
                                ================================ */
                                if (isProductOfferActive) {
                                  if (productOffer.discountType === "percentage") {
                                    productOfferPrice =
                                      price - (price * productOffer.discountValue) / 100
                                  } else if (productOffer.discountType === "flat") {
                                    productOfferPrice =
                                      price - productOffer.discountValue
                                  }
                                }
                                
                                /* ================================
                                   Calculate category offer price
                                ================================ */
                                if (isCategoryOfferActive) {
                                  if (categoryOffer.discountType === "percentage") {
                                    const percentPrice =
                                      price - (price * categoryOffer.discountValue) / 100
                                
                                    const maxPrice =
                                      price - categoryOffer.maxDiscountAmount
                                
                                    // Apply max discount cap
                                    categoryOfferPrice = Math.max(percentPrice, maxPrice)
                                
                                  } else if (categoryOffer.discountType === "flat") {
                                    if (price > categoryOffer.productMinPrice) {
                                      categoryOfferPrice =
                                        price - categoryOffer.discountValue
                                    }
                                  }
                                }
                                
                                /* ================================
                                   Decide final offer price
                                ================================ */
                                if (productOfferPrice !== null && categoryOfferPrice !== null) {
                                  // Both active → choose better discount
                                  offerPrice = Math.min(productOfferPrice, categoryOfferPrice)
                                
                                } else if (productOfferPrice !== null) {
                                  // Only product offer active
                                  offerPrice = productOfferPrice
                                
                                } else if (categoryOfferPrice !== null) {
                                  // Only category offer active
                                  offerPrice = categoryOfferPrice
                                }
                                // Else → no active offer, original price remains
                                %>
                            <div class="product-card mr-2 bg-white rounded-lg shadow-sm p-4 transition-all w-[240px] flex-shrink-0">
                                <div class="h-40 mb-3 relative">
                                    <img src="<%= products[i].variants[j].productImages[0] %>" alt="Product" class="w-full h-full object-contain">
                                    <% let isProductInWishlist = wishlistItems.find(item => String(products[i]._id) === String(item.productId) && item.variant === j)%>
                                    <button  type="button" class="absolute top-2 right-2 bg-white rounded-full p-2 shadow-md hover:bg-gray-100" onclick="removeFromWishlist('<%= products[i]._id %>','<%= j %>')">
                                        <i data-feather="heart" class="w-4 h-4" fill="#FF2400" stroke="#FF2400"></i>
                                    </button>
                                  
                                        <button id="addWishBtn<%= products[i]._id %><%= j %>" type="button" class="absolute top-2 right-2 bg-white rounded-full p-2 shadow-md hover:bg-gray-100 <%= (isProductInWishlist) ? 'hidden' : '' %>" onclick="addToWishlist(this,'<%= products[i]._id %>','<%= j %>')">
                                            <i  data-feather="heart" class="w-4 h-4" ></i>
                                        </button>
                                    <a href="/product?id=<%= products[i]._id %>&variant=<%= j%>">
                                        <button class="absolute top-12 right-2 bg-white rounded-full p-2 shadow-md hover:bg-gray-100">
                                            <i data-feather="eye" class="w-4 h-4"></i>
                                        </button>
                                    </a>
                                </div>
                                <h3 class="font-medium text-sm mb-1 truncate"><%= products[i].productName  %></h3>
                                <div class="flex items-center mb-1">
                                    <div class="text-yellow-400 flex">
                                        <i data-feather="star" class="w-4 h-4 fill-current"></i>
                                        <i data-feather="star" class="w-4 h-4 fill-current"></i>
                                        <i data-feather="star" class="w-4 h-4 fill-current"></i>
                                        <i data-feather="star" class="w-4 h-4 fill-current"></i>
                                        <i data-feather="star" class="w-4 h-4 fill-current"></i>
                                    </div>
                                    <span class="text-gray-500 text-xs ml-1">(4,567)</span>
                                </div>
                                <div class="flex items-center mb-2">
                                    <span class="font-regular text-xs">Brand : <a href="#" class="text-blue-700"><%= (products[i].brandId.brandName) %></a></span>
                                </div>
                                <div class="flex items-center mb-2">
                                    <span class="font-regular text-gray-700 text-xs">Size : <a href="#" ><%= (products[i].variants[j].size) %></a></span>
                                </div>
                                <div class="flex items-center mb-2">
                                    <% if (offerPrice > 0 && offerPrice < products[i].variants[j].price ) { %>
                                        <span class="font-bold text-lg">$ <span id="price<%= products[i]._id  %><%= j %>" ><%= offerPrice.toFixed(2) %></span></span>
                                        <span class="text-gray-500 text-sm line-through ml-2">$<%= (products[i].variants[j].price).toFixed(2)  %></span>
                                        <span class="text-green-600 text-xs font-medium ml-2"><%= (((products[i].variants[j].price - offerPrice) / products[i].variants[j].price) * 100).toFixed(0) %>% off</span>   
                                    <% } else {%>
                                        <span class="font-bold text-lg">$ <span id="price<%= products[i]._id %><%= j %>"><%= (products[i].variants[j].price).toFixed(2) %></span></span>
                                    <% } %>
                                </div>
                                 <% let isProductInCart = cartItems.find(item =>  String(products[i]._id) === String(item.productId._id) && item.variant === j ) || null %>
                                    <% if (isProductInCart) { %>
                                        <div class="flex  justify-between ">
                                        <button type="button" id="addToCartBtn<%= products[i]._id %><%= j %>" class="w-[0%] bg-yellow-400 hover:bg-yellow-500 text-gray-900  rounded-md font-medium text-sm flex items-center justify-center" onclick="addToCartInitially(this,'<%- i %>','<%- j %>','<%- products[i]._id %>','<%- j %>')">
                                            <i data-feather="shopping-cart" class="w-4 h-4 mr-2"></i> 
                                        </button>
                                            <div id="incDecQtyDiv<%= products[i]._id %><%= j %>" class="flex items-center justify-between w-[100%]  rounded-lg   border border-black w-full ">
                                                <button id="decQtyBtn<%= products[i]._id %><%= j %>" type="button" class="text-center flex justify-center w-full h-full bg-yellow-400 hover:bg-yellow-300 py-1 rounded-l-lg"  onclick="decrementQuantity('<%= i %>','<%= j %>','<%= products[i]._id %>')">
                                                    <i data-feather="minus"></i>
                                                </button> 
                                                <input type="text" id="quantity<%= products[i]._id %><%= j %>" value="<%= isProductInCart.quantity %>" class=" w-[5rem] px-2 text-xl bg-white font-bold py-[0.22rem] border-black-x-sides text-center" >
                                                <button id="incQtyBtn<%= products[i]._id %><%= j %>" type="button" class="text-center flex justify-center w-full h-full py-1 bg-yellow-400 hover:bg-yellow-300 rounded-r-lg"  onclick="incrementQuantity('<%= i %>','<%= j %>','<%= products[i]._id %>')">
                                                    <i data-feather="plus"></i>
                                                </button>
                                            </div>
                                        </div>
                                <% } else {%>
                                    <!-- <a  href="/home/cart?productId=&variant=&quantity=1"> -->
                                        <div id="incDecQtyDiv<%= products[i]._id %><%= j %>" class="flex items-center justify-between w-[100%] bg-yellow-400  border border-black rounded-lg hidden">
                                            <button id="decQtyBtn<%= products[i]._id %><%= j %>" type="button" class="text-center flex justify-center w-full h-full bg-yellow-400 hover:bg-yellow-300 py-1 rounded-l-lg" onclick="decrementQuantity('<%= i %>','<%= j %>','<%= products[i]._id %>')">
                                                <i data-feather="minus"></i>
                                            </button> 
                                            <input type="text" id="quantity<%= products[i]._id %><%= j %>" value="1" class=" w-[5rem] bg-white px-2 text-xl  py-[0.22rem] border-black-x-sides text-center" >
                                            <button id="incQtyBtn<%= products[i]._id %><%= j %>" type="button" class="text-center flex justify-center w-full h-full py-1 bg-yellow-400 hover:bg-yellow-300 rounded-r-lg" onclick="incrementQuantity('<%= i %>','<%= j %>','<%= products[i]._id %>')">
                                                <i data-feather="plus"></i>
                                            </button>
                                        </div>
                                        <button type="button" id="addToCartBtn<%= products[i]._id %><%= j %>" class="w-full bg-yellow-400 hover:bg-yellow-500 text-gray-900 py-2 rounded-md font-medium text-sm flex items-center justify-center" onclick="addToCartInitially(this,'<%- i %>','<%- j %>','<%- products[i]._id %>','<%- j %>')">
                                            <i data-feather="shopping-cart" class="w-4 h-4 mr-2"></i> Add to Cart
                                        </button>
                                <% } %>
                            </div>
                            <% } %>
                           <% } %>
                          <% } %>
                        <% } %>
                      <% } %>
                    <% } %>
                    <!-- More deal cards... -->
                </div>
            </div>
        </section>


        <!-- More sections... -->
    </main>

    

    <script>
        function addToWishlist(btn,productId,variant){
            btn.classList.add("hidden")
            let itemCount = document.getElementById("wishlistItemQty")
            fetch(`/wishlist?productId=${productId}&variant=${variant}`,{method : "POST"})
            .then(res => res.json())
            .then(data => {
                iziToast.success({
                    title : "Wishlist",
                    message : data.message,
                    position : "topRight"
                })
            })
            .catch(error => {
                iziToast.error({
                    title : "Wishlist",
                    message : error.message,
                    position : "topRight"
                })
            })
            if(Number(itemCount.innerText) === 0){
                itemCount.classList.remove("hidden")
                 let value = Number(itemCount.innerText)
                 value++
                 itemCount.innerText = value

            }else if(Number(itemCount.innerText) > 0){
                let value = Number(itemCount.innerText)
                value++
                itemCount.innerText = value
            }
        }
        function removeFromWishlist(productId,variant){
            document.getElementById(`addWishBtn${productId}${variant}`).classList.remove("hidden")
            let itemCount = document.getElementById("wishlistItemQty")
            fetch(`/wishlist/remove-wishlist-item?productId=${productId}&variant=${variant}`,{method : "DELETE"})
            .then(res => res.json())
            .then(data => {
                iziToast.success({
                    title : "Wishlist",
                    message : data.message,
                    position : "topRight"
                })
            })
            .catch(error => {
                iziToast.error({
                    title : "Wishlist",
                    message : error.message,
                    position : "topRight"
                })
            })
             if(Number(itemCount.innerText) > 0){
                let value = Number(itemCount.innerText)
                value--
                itemCount.innerText = value
                if(value === 0){
                    itemCount.classList.add("hidden")
                }
            }
        }
    </script>
    <!-- Footer -->
    <%- include("../partials/user-side/footer.ejs")%>

    
</body>
</html>
