<%- include("../partials/user-side/navbar.ejs")%>

  <!-- Product Section -->
  <main class="max-w-7xl mx-auto py-8 px-6">
    <div class="flex items-center " style="margin-bottom: 12px;">
      <a href="/" class="border border-gray-700 rounded-full px-2 py-2">
          
            <i data-feather="arrow-left" class="w-6 h-6 "></i>
            
      </a>
      <span class="ml-2">Back to Home</span>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
      <!-- Left - Image -->
      <div>
    
        <div id="imageZoom" style=" 
          --url : url(<%= product.variants[variant].productImages[0] %>);
          --zoom-x : 0%; --zoom-y : 0%;
          --display : none;
         " class="shadow-lg">
          <img id="mainImage" src="<%= product.variants[variant].productImages[0] %>" alt="Bag" class="  rounded-lg border shadow-sm">
        </div>
        <div class="w-[500px] flex flex-wrap mt-4">
          <% for( let i = 0; i < product.variants[variant].productImages.length; i++ ) { %>
           
          <img src="<%= product.variants[variant].productImages[i] %>" class="thumbnail w-16 h-16 border rounded-md cursor-pointer hover:ring-2 hover:ring-emerald-500 mr-1 mb-1" />
           
          <% } %>
          
        </div>
      </div>

      <!-- Right - Details -->
      <div>
        <h2 class="text-2xl font-semibold leading-snug">
          <%= product.productName %>
        </h2>
        <p class="text-yellow-500 mt-2">★★★★★ <span class="text-gray-500 text-sm">(65 Reviews)</span> <span class="text-green-500 text-sm"><%= product.variants[0].stockStatus  %></span></p>
        <div class="flex items-center gap-3 mt-3">
            <p class="text-sm font-medium text-black"><%= product.description %></p>
          </div>
          <div class="flex items-center gap-3 mt-3"><form id="colorForm" class="flex gap-3 flex-wrap">
            <form>
              <% if (product.variants.length > 1) { %>
              <% for( let i = 0; i < product.variants.length; i++ ) { %>
                <% if (variant == i) { %>
                  <label class="cursor-pointer">
                    <input type="radio" name="color" value="<%= product.variants[i].color %>" class="hidden peer" checked>
                    <div class="border border-gray-300 px-5 py-2 rounded-lg peer-checked:bg-black peer-checked:text-white transition">
                      <%= product.variants[i].color %>
                    </div>
                  </label>
                <% }else{ %>
                  <label class="cursor-pointer">
                    <input type="radio" name="color" value="<%= product.variants[i].color %>" class="hidden peer" >
                    <a href="/product?id=<%= product._id %>&variant=<%= i %>">
                      <div class="border border-gray-300 px-5 py-2 rounded-lg peer-checked:bg-black peer-checked:text-white transition">
                        <%= product.variants[i].color %>
                      </div>
                    </a>
                  </label>
                  <% }%>
            
             <% } %>
            <% }else{ %>
              <div class="border border-gray-500 px-5 py-2 rounded-lg peer-checked:bg-black peer-checked:text-white transition">
                <%= product.variants[variant].color %>
              </div>
              <%}%>
          </form>
          </div>
          
        <div class="flex items-center gap-3 mt-3">
          <p class="text-3xl font-bold text-black">$<%= (product.variants[0].price * 75/100).toFixed(2) %></p>
          <p class="line-through text-gray-400 text-lg">$<%= product.variants[0].price %></p>
        </div>
        <div class=" items-center gap-3 mt-3">
            <p class="text-gray-600 flex"><span class="iconify text-green-400" data-icon="charm-tick" style="width: 20;height: 20;"></span>&ensp;Free Delivery</p>
            <p class="text-gray-600 flex"><span class="iconify text-green-400" data-icon="charm-tick" style="width: 20;height: 20;"></span>&ensp;Secure Payment</p>
          </div>
        <div class="flex items-center gap-3 mt-4">
          <label class="font-semibold">Qty:</label>
          <input type="number" value="1" class="w-16 border rounded-md text-center p-1">
        </div>
        <div class="flex items-center gap-3 mt-4">
            <button class="bg-yellow-400 hover:bg-yellow-300 text-gray-700 font-extrabold  px-6 py-3 rounded-lg shadow">Buy Now</button>
            <button class="bg-yellow-400 hover:bg-yellow-300 text-gray-700 font-semibold  px-6 py-2 rounded-lg shadow">
                <span class="iconify" data-icon="solar-cart-3-linear" style="width: 32;height: 32;"></span></button>
        </div>
        
      </div>

    </div>

    <!-- Related Products -->
    <section class="mt-14">
      <h3 class="text-xl font-semibold mb-5">Related Products</h3>
      <div class="grid grid-cols-2 md:grid-cols-5 gap-5">
        <!-- Card -->
         <% for( let i = 0; i < relatedProduct.length; i++ ) { %>
         <% for( let j = 0; j < relatedProduct[i].variants.length; j++ ) { %>
          <% if (!relatedProduct[i].categoryId.isDeleted && !relatedProduct[i].brandId.isDeleted) { %>
           <% if (!relatedProduct[i].isDeleted) { %>
            <% if (String(relatedProduct[i]._id) !== String(product._id)) { %>
                <div class="product-card bg-white rounded-lg shadow-sm p-4 transition-all">
                  <div class="h-40 mb-3 relative">
                      <img src="<%= relatedProduct[i].variants[j].productImages[0] %>" alt="Product" class="w-full h-full object-contain">
                      <button class="absolute top-2 right-2 bg-white rounded-full p-2 shadow-md hover:bg-gray-100">
                          <i data-feather="heart" class="w-4 h-4"></i>
                      </button>
                      <a href="/product?id=<%= relatedProduct[i]._id %>&variant=<%= j%>">
                          <button class="absolute top-12 right-2 bg-white rounded-full p-2 shadow-md hover:bg-gray-100">
                              <i data-feather="eye" class="w-4 h-4"></i>
                          </button>
                      </a>
                  </div>
                  <h3 class="font-medium text-sm mb-1 truncate"><%= relatedProduct[i].productName  %></h3>
                  <div class="flex items-center mb-1">
                      <div class="text-yellow-400 flex">
                          <i data-feather="star" class="w-4 h-4 fill-current"></i>
                          <i data-feather="star" class="w-4 h-4 fill-current"></i>
                          <i data-feather="star" class="w-4 h-4 fill-current"></i>
                          <i data-feather="star" class="w-4 h-4 fill-current"></i>
                          <i data-feather="star" class="w-4 h-4 fill-current"></i>
                      </div>
                      <span class="text-gray-500 text-xs ml-1">(4,567)</span>
                  </div>
                  <div class="flex items-center mb-2">
                      <span class="font-regular text-xs">Brand : <a href="#" class="text-blue-700"><%= (relatedProduct[i].brandId.brandName) %></a></span>
                  </div>
                  <div class="flex items-center mb-2">
                      <span class="font-regular text-gray-400 text-xs">Color : <a href="#" ><%= (relatedProduct[i].variants[j].color) %></a></span>
                  </div>
                  <div class="flex items-center mb-2">
                      <span class="font-bold text-lg">$<%= (relatedProduct[i].variants[j].price * 62/100).toFixed(2) %></span>
                      <span class="text-gray-500 text-sm line-through ml-2">$<%= relatedProduct[i].variants[j].price %></span>
                      <span class="text-green-600 text-xs font-medium ml-2">38% off</span>
                  </div>
                  <button class="w-full bg-yellow-400 hover:bg-yellow-500 text-gray-900 py-2 rounded-md font-medium text-sm flex items-center justify-center">
                      <i data-feather="shopping-cart" class="w-4 h-4 mr-2"></i> Add to Cart
                  </button>
              </div>  
                          
              <% } else {%>
                <% if (variant != j) { %>
                  <div class="product-card bg-white rounded-lg shadow-sm p-4 transition-all">
                    <div class="h-40 mb-3 relative">
                        <img src="<%= relatedProduct[i].variants[j].productImages[0] %>" alt="Product" class="w-full h-full object-contain">
                        <button class="absolute top-2 right-2 bg-white rounded-full p-2 shadow-md hover:bg-gray-100">
                            <i data-feather="heart" class="w-4 h-4"></i>
                        </button>
                        <a href="/product?id=<%= relatedProduct[i]._id %>&variant=<%= j%>">
                            <button class="absolute top-12 right-2 bg-white rounded-full p-2 shadow-md hover:bg-gray-100">
                                <i data-feather="eye" class="w-4 h-4"></i>
                            </button>
                        </a>
                    </div>
                    <h3 class="font-medium text-sm mb-1 truncate"><%= relatedProduct[i].productName  %></h3>
                    <div class="flex items-center mb-1">
                        <div class="text-yellow-400 flex">
                            <i data-feather="star" class="w-4 h-4 fill-current"></i>
                            <i data-feather="star" class="w-4 h-4 fill-current"></i>
                            <i data-feather="star" class="w-4 h-4 fill-current"></i>
                            <i data-feather="star" class="w-4 h-4 fill-current"></i>
                            <i data-feather="star" class="w-4 h-4 fill-current"></i>
                        </div>
                        <span class="text-gray-500 text-xs ml-1">(4,567)</span>
                    </div>
                    <div class="flex items-center mb-2">
                        <span class="font-regular text-xs">Brand : <a href="#" class="text-blue-700"><%= (relatedProduct[i].brandId.brandName) %></a></span>
                    </div>
                    <div class="flex items-center mb-2">
                        <span class="font-regular text-gray-400 text-xs">Color : <a href="#" ><%= (relatedProduct[i].variants[j].color) %></a></span>
                    </div>
                    <div class="flex items-center mb-2">
                        <span class="font-bold text-lg">$<%= (relatedProduct[i].variants[j].price * 62/100).toFixed(2) %></span>
                        <span class="text-gray-500 text-sm line-through ml-2">$<%= relatedProduct[i].variants[j].price %></span>
                        <span class="text-green-600 text-xs font-medium ml-2">38% off</span>
                    </div>
                    <button class="w-full bg-yellow-400 hover:bg-yellow-500 text-gray-900 py-2 rounded-md font-medium text-sm flex items-center justify-center">
                        <i data-feather="shopping-cart" class="w-4 h-4 mr-2"></i> Add to Cart
                    </button>
                </div>  
                <% } %>
                <% }%>
             <% } %>
           <% } %>
         <% } %>
         <% } %>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <%- include("../partials/user-side/footer.ejs")%>
<script>
  feather.replace();
        const mainImage = document.getElementById("mainImage");
        const thumbnails = document.querySelectorAll(".thumbnail");
        let imageZoom = document.getElementById("imageZoom")
        thumbnails.forEach(thumbnail => {
        thumbnail.addEventListener("click", () => {
            // Update main image source
            mainImage.src = thumbnail.src;
            imageZoom.style.setProperty("--url",`url(${thumbnail.src})`)
        });
        });
        imageZoom.addEventListener("mousemove",(event) => {
          imageZoom.style.setProperty("--display","block")
          let pointer = {
            x : (event.offsetX * 100) / imageZoom.offsetWidth,
            y : (event.offsetY * 100) / imageZoom.offsetHeight
          }
         imageZoom.style.setProperty("--zoom-x",pointer.x + "%")
         imageZoom.style.setProperty("--zoom-y",pointer.y + "%")
        })
        imageZoom.addEventListener("mouseout",(event) => {
          imageZoom.style.setProperty("--display","none")
        })
 </script>
</body>
</html>
