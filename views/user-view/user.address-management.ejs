<%- include("../partials/user-side/navbar.ejs")%>

<div class="flex">
    <%- include("../partials/user-side/userProfile-sidebar.ejs",{dashboardBtn : "",profileBtn : "",ordersBtn : "",shoppingCartBtn : "",addressBtn : "active disabled",walletBtn : ""})%>
    <div class="main-content">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold">Address Book</h1>
            <button onclick="openAddAddressModal()" class="btn-primary px-4 py-2  rounded-xl  flex items-center">
                <i data-feather="plus" class="w-4 h-4 mr-2"></i>
                Add New Address
            </button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <input id="serverMessage" type="text" value="<%= message %>"  hidden>
            <!-- Default Address -->
            <% if (defaultAddress !== null) { %>
                <div class="address-card p-6 relative">
                    <div class="flex justify-between items-start mb-4">
                        <h2 class="text-lg font-bold">Default Address</h2>
                        <span class="default-badge text-xs font-medium px-2 py-1 rounded-full">Default</span>
                    </div>
                    <div class="space-y-2 text-gray-700">
                        <p><strong>Name:</strong><span id="firstName0"> <%= defaultAddress.firstName %></span> <span id="lastName0"><%= defaultAddress.lastName %></span></p>
                        <p><strong>Country:</strong><span id="country0"> <%= defaultAddress.country %></span></p>
                        <p><strong>State:</strong><span id="state0"> <%= defaultAddress.state %></span></p>
                        <p><strong>City:</strong><span id="city0"> <%= defaultAddress.city %></span></p>
                        <p><strong>Address:</strong><span id="address0"> <%= defaultAddress.address %></span></p>
                        <p><strong>Pincode:</strong><span  id="pincode0" > <%= defaultAddress.pincode %></span></p>
                        <p  class="mt-2"><strong>Phone:</strong><span id="mobileNo0"> <%= defaultAddress.mobileNo  %></span></p>
                    </div>
                    <div class="flex justify-end space-x-3 mt-4">
                        <button id="editBtn0" class="btn-primary px-4 py-2 rounded-xl font-bold" onclick="editAddress(0,'<%- defaultAddress._id %>')" >
                            Edit
                        </button>
                        <button class="text-gray-700 font-bold hover:text-black flex rounded-xl  bg-red-400 hover:bg-red-500 px-4 py-2 items-center text-sm" onclick="deleteAddress('<%- defaultAddress._id %>','<%- defaultAddress.userId %>')">
                            <i data-feather="trash-2" class="w-4 h-4 mr-1"></i> Delete
                        </button>
                    </div>
                </div>
            <% }else{ %>
                <div class="address-card p-6 relative">
                    <div class="flex justify-between items-start mb-4">
                        <h2 class="text-lg font-bold">Default Address</h2>
                        <span class="text-xs text-gray-400 rounded-full bg-gray-200 font-medium px-2 py-1 rounded-full">Default</span>
                    </div>
                    <div class="space-y-2 text-gray-700">
                        <p><strong>Name:</strong> Not Provided</p>
                        <p><strong>Country:</strong>  Not Provided</p>
                        <p><strong>State:</strong> Not Provided</p>
                        <p><strong>City:</strong> Not Provided</p>
                        <p><strong>Address:</strong> Not Provided</p>
                        <p><strong>Pincode:</strong> Not Provided</p>
                        <p class="mt-2"><strong>Phone:</strong> Not Provided</p>
                    </div>
                    <div class="flex justify-end space-x-3 mt-4">
                        <button class="text-gray-400 font-bold  flex rounded-xl  bg-gray-200  px-4 py-2 items-center text-sm" disabled >
                            Edit
                        </button>
                        <button class="text-gray-400 font-bold  flex rounded-xl  bg-gray-200  px-4 py-2 items-center text-sm" disabled>
                            <i data-feather="trash-2" class="w-4 h-4 mr-1"></i> Delete
                        </button>
                    </div>
                </div>
                <% } %>

            <!-- Other Addresses -->
            <% for( let i = 0; i < addressList.length; i++ ) { %>
                <div class="address-card p-6">
                    <h2 class="text-lg font-bold mb-4">Other Address <%= i + 1 %></h2>
                    <div class="space-y-2 text-gray-700">
                        <p><strong>Name:</strong><span id="firstName<%= i + 1 %>"> <%= addressList[i].firstName %></span> <span id="lastName<%= i + 1 %>"><%= addressList[i].lastName %></span></p>
                        <p><strong>Country:</strong><span id="country<%= i + 1 %>"> <%= addressList[i].country %></span></p>
                        <p><strong>State:</strong><span id="state<%= i + 1 %>"> <%= addressList[i].state %></span></p>
                        <p><strong>City:</strong><span id="city<%= i + 1 %>"> <%= addressList[i].city %></span></p>
                        <p><strong>Address:</strong><span id="address<%= i + 1  %>"> <%= addressList[i].address %></span></p>
                        <p><strong>Pincode:</strong><span id="pincode<%= i + 1  %>"> <%= addressList[i].pincode %></span></p>
                        <p class="mt-2"><strong>Phone:</strong><span id="mobileNo<%= i + 1  %>"> <%= addressList[i].mobileNo  %></span></p>
                    </div>
                    <div class="flex justify-between mt-4">
                        <button id="resetDefaultAddressBtn<%= i + 1 %>" class="text-gray-700 bg-green-300 hover:bg-green-400 pl-2 pr-3 font-bold py-2 rounded-xl flex items-center text-sm" onclick="changeDefaultAddress('<%- addressList[i]._id %>')">
                            <i data-feather="check" class="w-4 h-4 mr-1"></i> Set as Default
                        </button>
                        <div class="flex space-x-3">
                            <button id="editBtn<%= i + 1  %>" class="btn-primary px-4 py-2 rounded-xl font-bold" onclick="editAddress('<%= i + 1%>','<%- addressList[i]._id %>')">
                                Edit
                            </button>
                            <button class="text-gray-700 font-bold hover:text-black flex rounded-xl  bg-red-400 hover:bg-red-500 px-4 py-2 items-center text-sm" onclick="deleteAddress('<%- addressList[i]._id %>','<%- addressList[i].userId %>')">
                                <i data-feather="trash-2" class="w-4 h-4 mr-1"></i> Delete
                            </button>
                        </div>
                    </div>
                </div>
            <% } %>

            <!-- More addresses would go here -->
        </div>
    </div>

    <!-- Add Address Modal -->
    
</div>
<div id="addAddressModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 w-full max-w-md">
        <div class="flex justify-between items-center mb-4">
            <h2 id="addressFormHeading" class="text-xl font-bold">Add New Address</h2>
            <button onclick="closeAddAddressModal()" class="text-gray-500 hover:text-gray-700">
                <i data-feather="x"></i>
            </button>
        </div>
        <form action="/address" method="post" class="space-y-4"  novalidate>
            
            
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                    <input type="text" id="firstName" name="firstName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
                    <input type="text" id="lastName" name="lastName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                </div>
                
            </div>
            <div>
                <p id="reg-name-p" class="text-xs text-gray-500 mt-1">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="13"
                    height="13"
                    fill="currentColor"
                    class="bi bi-info-circle inline-block"
                    viewBox="0 0 16 16"
                  >
                    <path
                      d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"
                    />
                    <path
                      d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"
                    />
                  </svg>
                  Name must contain only letters and spaces, with at least 5
                  characters and should not contain any number
                </p>
              </div>
            <div class="flex items-center">
                <input type="checkbox" id="accountName" class="h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded">
                <label id="forAccountName" for="accountName" class="ml-2 block text-sm text-gray-700">Same as account name</label>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">State / Province</label>
                    <input type="text" id="state" name="state" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">City</label>
                    <input type="text" id="city" name="city" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Country</label>
                    <select id="countryList" name="country" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" onchange="doesTheCountryHavePincode(this.value)">

                        <option value="" selected>Select Country</option>

                        <option value="AF">ğŸ‡¦ğŸ‡« Afghanistan</option>
                        <option value="AL">ğŸ‡¦ğŸ‡± Albania</option>
                        <option value="DZ">ğŸ‡©ğŸ‡¿ Algeria</option>
                        <option value="AD">ğŸ‡¦ğŸ‡© Andorra</option>
                        <option value="AO">ğŸ‡¦ğŸ‡´ Angola</option>
                        <option value="AG">ğŸ‡¦ğŸ‡¬ Antigua and Barbuda</option>
                        <option value="AR">ğŸ‡¦ğŸ‡· Argentina</option>
                        <option value="AM">ğŸ‡¦ğŸ‡² Armenia</option>
                        <option value="AU">ğŸ‡¦ğŸ‡º Australia</option>
                        <option value="AT">ğŸ‡¦ğŸ‡¹ Austria</option>
                        <option value="AZ">ğŸ‡¦ğŸ‡¿ Azerbaijan</option>
                        
                        <option value="BS">ğŸ‡§ğŸ‡¸ Bahamas</option>
                        <option value="BH">ğŸ‡§ğŸ‡­ Bahrain</option>
                        <option value="BD">ğŸ‡§ğŸ‡© Bangladesh</option>
                        <option value="BB">ğŸ‡§ğŸ‡§ Barbados</option>
                        <option value="BY">ğŸ‡§ğŸ‡¾ Belarus</option>
                        <option value="BE">ğŸ‡§ğŸ‡ª Belgium</option>
                        <option value="BZ">ğŸ‡§ğŸ‡¿ Belize</option>
                        <option value="BJ">ğŸ‡§ğŸ‡¯ Benin</option>
                        <option value="BT">ğŸ‡§ğŸ‡¹ Bhutan</option>
                        <option value="BO">ğŸ‡§ğŸ‡´ Bolivia</option>
                        <option value="BA">ğŸ‡§ğŸ‡¦ Bosnia and Herzegovina</option>
                        <option value="BW">ğŸ‡§ğŸ‡¼ Botswana</option>
                        <option value="BR">ğŸ‡§ğŸ‡· Brazil</option>
                        <option value="BN">ğŸ‡§ğŸ‡³ Brunei</option>
                        <option value="BG">ğŸ‡§ğŸ‡¬ Bulgaria</option>
                        <option value="BF">ğŸ‡§ğŸ‡« Burkina Faso</option>
                        <option value="BI">ğŸ‡§ğŸ‡® Burundi</option>
                        
                        <option value="KH">ğŸ‡°ğŸ‡­ Cambodia</option>
                        <option value="CM">ğŸ‡¨ğŸ‡² Cameroon</option>
                        <option value="CA">ğŸ‡¨ğŸ‡¦ Canada</option>
                        <option value="CV">ğŸ‡¨ğŸ‡» Cape Verde</option>
                        <option value="CF">ğŸ‡¨ğŸ‡« Central African Republic</option>
                        <option value="TD">ğŸ‡¹ğŸ‡© Chad</option>
                        <option value="CL">ğŸ‡¨ğŸ‡± Chile</option>
                        <option value="CN">ğŸ‡¨ğŸ‡³ China</option>
                        <option value="CO">ğŸ‡¨ğŸ‡´ Colombia</option>
                        <option value="KM">ğŸ‡°ğŸ‡² Comoros</option>
                        <option value="CG">ğŸ‡¨ğŸ‡¬ Congo</option>
                        <option value="CR">ğŸ‡¨ğŸ‡· Costa Rica</option>
                        <option value="HR">ğŸ‡­ğŸ‡· Croatia</option>
                        <option value="CU">ğŸ‡¨ğŸ‡º Cuba</option>
                        <option value="CY">ğŸ‡¨ğŸ‡¾ Cyprus</option>
                        <option value="CZ">ğŸ‡¨ğŸ‡¿ Czech Republic</option>
                        
                        <option value="DK">ğŸ‡©ğŸ‡° Denmark</option>
                        <option value="DJ">ğŸ‡©ğŸ‡¯ Djibouti</option>
                        <option value="DM">ğŸ‡©ğŸ‡² Dominica</option>
                        <option value="DO">ğŸ‡©ğŸ‡´ Dominican Republic</option>
                        
                        <option value="EC">ğŸ‡ªğŸ‡¨ Ecuador</option>
                        <option value="EG">ğŸ‡ªğŸ‡¬ Egypt</option>
                        <option value="SV">ğŸ‡¸ğŸ‡» El Salvador</option>
                        <option value="GQ">ğŸ‡¬ğŸ‡¶ Equatorial Guinea</option>
                        <option value="ER">ğŸ‡ªğŸ‡· Eritrea</option>
                        <option value="EE">ğŸ‡ªğŸ‡ª Estonia</option>
                        <option value="SZ">ğŸ‡¸ğŸ‡¿ Eswatini</option>
                        <option value="ET">ğŸ‡ªğŸ‡¹ Ethiopia</option>
                        
                        <option value="FJ">ğŸ‡«ğŸ‡¯ Fiji</option>
                        <option value="FI">ğŸ‡«ğŸ‡® Finland</option>
                        <option value="FR">ğŸ‡«ğŸ‡· France</option>
                        
                        <option value="GA">ğŸ‡¬ğŸ‡¦ Gabon</option>
                        <option value="GM">ğŸ‡¬ğŸ‡² Gambia</option>
                        <option value="GE">ğŸ‡¬ğŸ‡ª Georgia</option>
                        <option value="DE">ğŸ‡©ğŸ‡ª Germany</option>
                        <option value="GH">ğŸ‡¬ğŸ‡­ Ghana</option>
                        <option value="GR">ğŸ‡¬ğŸ‡· Greece</option>
                        <option value="GD">ğŸ‡¬ğŸ‡© Grenada</option>
                        <option value="GT">ğŸ‡¬ğŸ‡¹ Guatemala</option>
                        <option value="GN">ğŸ‡¬ğŸ‡³ Guinea</option>
                        <option value="GW">ğŸ‡¬ğŸ‡¼ Guinea-Bissau</option>
                        <option value="GY">ğŸ‡¬ğŸ‡¾ Guyana</option>
                        
                        <option value="HT">ğŸ‡­ğŸ‡¹ Haiti</option>
                        <option value="HN">ğŸ‡­ğŸ‡³ Honduras</option>
                        <option value="HU">ğŸ‡­ğŸ‡º Hungary</option>
                        
                        <option value="IS">ğŸ‡®ğŸ‡¸ Iceland</option>
                        <option value="IN">ğŸ‡®ğŸ‡³ India</option>
                        <option value="ID">ğŸ‡®ğŸ‡© Indonesia</option>
                        <option value="IR">ğŸ‡®ğŸ‡· Iran</option>
                        <option value="IQ">ğŸ‡®ğŸ‡¶ Iraq</option>
                        <option value="IE">ğŸ‡®ğŸ‡ª Ireland</option>
                        <option value="IL">ğŸ‡®ğŸ‡± Israel</option>
                        <option value="IT">ğŸ‡®ğŸ‡¹ Italy</option>
                        
                        <option value="JM">ğŸ‡¯ğŸ‡² Jamaica</option>
                        <option value="JP">ğŸ‡¯ğŸ‡µ Japan</option>
                        <option value="JO">ğŸ‡¯ğŸ‡´ Jordan</option>
                        
                        <option value="KZ">ğŸ‡°ğŸ‡¿ Kazakhstan</option>
                        <option value="KE">ğŸ‡°ğŸ‡ª Kenya</option>
                        <option value="KI">ğŸ‡°ğŸ‡® Kiribati</option>
                        <option value="KP">ğŸ‡°ğŸ‡µ North Korea</option>
                        <option value="KR">ğŸ‡°ğŸ‡· South Korea</option>
                        <option value="KW">ğŸ‡°ğŸ‡¼ Kuwait</option>
                        <option value="KG">ğŸ‡°ğŸ‡¬ Kyrgyzstan</option>
                        
                        <option value="LA">ğŸ‡±ğŸ‡¦ Laos</option>
                        <option value="LV">ğŸ‡±ğŸ‡» Latvia</option>
                        <option value="LB">ğŸ‡±ğŸ‡§ Lebanon</option>
                        <option value="LS">ğŸ‡±ğŸ‡¸ Lesotho</option>
                        <option value="LR">ğŸ‡±ğŸ‡· Liberia</option>
                        <option value="LY">ğŸ‡±ğŸ‡¾ Libya</option>
                        <option value="LI">ğŸ‡±ğŸ‡® Liechtenstein</option>
                        <option value="LT">ğŸ‡±ğŸ‡¹ Lithuania</option>
                        <option value="LU">ğŸ‡±ğŸ‡º Luxembourg</option>
                        
                        <option value="MG">ğŸ‡²ğŸ‡¬ Madagascar</option>
                        <option value="MW">ğŸ‡²ğŸ‡¼ Malawi</option>
                        <option value="MY">ğŸ‡²ğŸ‡¾ Malaysia</option>
                        <option value="MV">ğŸ‡²ğŸ‡» Maldives</option>
                        <option value="ML">ğŸ‡²ğŸ‡± Mali</option>
                        <option value="MT">ğŸ‡²ğŸ‡¹ Malta</option>
                        <option value="MH">ğŸ‡²ğŸ‡­ Marshall Islands</option>
                        <option value="MR">ğŸ‡²ğŸ‡· Mauritania</option>
                        <option value="MU">ğŸ‡²ğŸ‡º Mauritius</option>
                        <option value="MX">ğŸ‡²ğŸ‡½ Mexico</option>
                        <option value="FM">ğŸ‡«ğŸ‡² Micronesia</option>
                        <option value="MD">ğŸ‡²ğŸ‡© Moldova</option>
                        <option value="MC">ğŸ‡²ğŸ‡¨ Monaco</option>
                        <option value="MN">ğŸ‡²ğŸ‡³ Mongolia</option>
                        <option value="ME">ğŸ‡²ğŸ‡ª Montenegro</option>
                        <option value="MA">ğŸ‡²ğŸ‡¦ Morocco</option>
                        <option value="MZ">ğŸ‡²ğŸ‡¿ Mozambique</option>
                        <option value="MM">ğŸ‡²ğŸ‡² Myanmar</option>
                        
                        <option value="NA">ğŸ‡³ğŸ‡¦ Namibia</option>
                        <option value="NR">ğŸ‡³ğŸ‡· Nauru</option>
                        <option value="NP">ğŸ‡³ğŸ‡µ Nepal</option>
                        <option value="NL">ğŸ‡³ğŸ‡± Netherlands</option>
                        <option value="NZ">ğŸ‡³ğŸ‡¿ New Zealand</option>
                        <option value="NI">ğŸ‡³ğŸ‡® Nicaragua</option>
                        <option value="NE">ğŸ‡³ğŸ‡ª Niger</option>
                        <option value="NG">ğŸ‡³ğŸ‡¬ Nigeria</option>
                        <option value="MK">ğŸ‡²ğŸ‡° North Macedonia</option>
                        <option value="NO">ğŸ‡³ğŸ‡´ Norway</option>
                        
                        <option value="OM">ğŸ‡´ğŸ‡² Oman</option>
                        
                        <option value="PK">ğŸ‡µğŸ‡° Pakistan</option>
                        <option value="PW">ğŸ‡µğŸ‡¼ Palau</option>
                        <option value="PA">ğŸ‡µğŸ‡¦ Panama</option>
                        <option value="PG">ğŸ‡µğŸ‡¬ Papua New Guinea</option>
                        <option value="PY">ğŸ‡µğŸ‡¾ Paraguay</option>
                        <option value="PE">ğŸ‡µğŸ‡ª Peru</option>
                        <option value="PH">ğŸ‡µğŸ‡­ Philippines</option>
                        <option value="PL">ğŸ‡µğŸ‡± Poland</option>
                        <option value="PT">ğŸ‡µğŸ‡¹ Portugal</option>
                        
                        <option value="QA">ğŸ‡¶ğŸ‡¦ Qatar</option>
                        
                        <option value="RO">ğŸ‡·ğŸ‡´ Romania</option>
                        <option value="RU">ğŸ‡·ğŸ‡º Russia</option>
                        <option value="RW">ğŸ‡·ğŸ‡¼ Rwanda</option>
                        
                        <option value="SA">ğŸ‡¸ğŸ‡¦ Saudi Arabia</option>
                        <option value="SN">ğŸ‡¸ğŸ‡³ Senegal</option>
                        <option value="RS">ğŸ‡·ğŸ‡¸ Serbia</option>
                        <option value="SC">ğŸ‡¸ğŸ‡¨ Seychelles</option>
                        <option value="SL">ğŸ‡¸ğŸ‡± Sierra Leone</option>
                        <option value="SG">ğŸ‡¸ğŸ‡¬ Singapore</option>
                        <option value="SK">ğŸ‡¸ğŸ‡° Slovakia</option>
                        <option value="SI">ğŸ‡¸ğŸ‡® Slovenia</option>
                        <option value="SB">ğŸ‡¸ğŸ‡§ Solomon Islands</option>
                        <option value="SO">ğŸ‡¸ğŸ‡´ Somalia</option>
                        <option value="ZA">ğŸ‡¿ğŸ‡¦ South Africa</option>
                        <option value="SS">ğŸ‡¸ğŸ‡¸ South Sudan</option>
                        <option value="ES">ğŸ‡ªğŸ‡¸ Spain</option>
                        <option value="LK">ğŸ‡±ğŸ‡° Sri Lanka</option>
                        <option value="SD">ğŸ‡¸ğŸ‡© Sudan</option>
                        <option value="SR">ğŸ‡¸ğŸ‡· Suriname</option>
                        <option value="SE">ğŸ‡¸ğŸ‡ª Sweden</option>
                        <option value="CH">ğŸ‡¨ğŸ‡­ Switzerland</option>
                        <option value="SY">ğŸ‡¸ğŸ‡¾ Syria</option>
                        
                        <option value="TW">ğŸ‡¹ğŸ‡¼ Taiwan</option>
                        <option value="TJ">ğŸ‡¹ğŸ‡¯ Tajikistan</option>
                        <option value="TZ">ğŸ‡¹ğŸ‡¿ Tanzania</option>
                        <option value="TH">ğŸ‡¹ğŸ‡­ Thailand</option>
                        <option value="TL">ğŸ‡¹ğŸ‡± Timor-Leste</option>
                        <option value="TG">ğŸ‡¹ğŸ‡¬ Togo</option>
                        <option value="TO">ğŸ‡¹ğŸ‡´ Tonga</option>
                        <option value="TT">ğŸ‡¹ğŸ‡¹ Trinidad and Tobago</option>
                        <option value="TN">ğŸ‡¹ğŸ‡³ Tunisia</option>
                        <option value="TR">ğŸ‡¹ğŸ‡· Turkey</option>
                        <option value="TM">ğŸ‡¹ğŸ‡² Turkmenistan</option>
                        <option value="TV">ğŸ‡¹ğŸ‡» Tuvalu</option>
                        
                        <option value="UG">ğŸ‡ºğŸ‡¬ Uganda</option>
                        <option value="UA">ğŸ‡ºğŸ‡¦ Ukraine</option>
                        <option value="AE">ğŸ‡¦ğŸ‡ª United Arab Emirates</option>
                        <option value="GB">ğŸ‡¬ğŸ‡§ United Kingdom</option>
                        <option value="US">ğŸ‡ºğŸ‡¸ United States</option>
                        
                        <option value="UY">ğŸ‡ºğŸ‡¾ Uruguay</option>
                        <option value="UZ">ğŸ‡ºğŸ‡¿ Uzbekistan</option>
                        
                        <option value="VU">ğŸ‡»ğŸ‡º Vanuatu</option>
                        <option value="VA">ğŸ‡»ğŸ‡¦ Vatican City</option>
                        <option value="VE">ğŸ‡»ğŸ‡ª Venezuela</option>
                        <option value="VN">ğŸ‡»ğŸ‡³ Vietnam</option>
                        
                        <option value="YE">ğŸ‡¾ğŸ‡ª Yemen</option>
                        
                        <option value="ZM">ğŸ‡¿ğŸ‡² Zambia</option>
                        <option value="ZW">ğŸ‡¿ğŸ‡¼ Zimbabwe</option>
                    
                      </select>
                      
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Postal Code / Pincode / ZIP</label>
                    <input type="text" id="pincode" name="pincode" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                </div>
            </div>

             
            <div>
                <label for="phoneNumber" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                <input type="tel" id="phoneNumber" name="mobileNo" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
            </div>
            


            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Address</label>
                <textarea type="text" id="address" name="address" class=" border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"></textarea>
            </div>
            
            <div class="flex items-center">
                <input type="checkbox" id="defaultAddress" name="isDefault" value="false" class="h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded">
                <label id="forDefaultAddress" for="defaultAddress" class="ml-2 block text-sm text-gray-700">Set as default address</label>
            </div>
            
            <div class="flex justify-end space-x-3 pt-4">
                <button type="button" onclick="closeAddAddressModal()" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
                    Cancel
                </button>
                <button type="submit" class="btn-primary font-bold px-4 py-2 border border-transparent rounded-lg ">
                    Save Address
                </button>
            </div>
        </form>
    </div>
</div>

<script>

</script>
<%- include("../partials/user-side/footer.ejs")%>
<script>
      const input = document.querySelector("#phoneNumber");
    let iti = window.intlTelInput(input, {
      utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js", // for formatting and validation
      initialCountry: "auto", // or a specific country code like "us"
      geoIpLookup: function(callback) { // optional: lookup user's country based on IP
        fetch("https://ipapi.co/json")
          .then(res => res.json())
          .then(data => {
            countryCode = data.country_calling_code
          return callback(data.country_code)
          })
          .catch(() => callback("us")); // default to US on error
      },
    });

    const serverMessage = document.getElementById("serverMessage").value
    if(serverMessage === "Address added successfully!"){
        iziToast.success({
            title : "Success",
            message : "Address added successfully!",
            position : "topRight"
        })
    }
    if(serverMessage === "Oops! some error has occured"){
        iziToast.error({
            title : "Error",
            message :"Oops! some error has occured",
            position : "topRight"
        })
    }
    if(serverMessage === "Address updated Successfully"){
        iziToast.success({
            title : "Success",
            message :"Address updated Successfully",
            position : "topRight"
        })
    }
    if(serverMessage === "Address deleted Successfully"){
        iziToast.success({
            title : "Success",
            message :"Address deleted Successfully",
            position : "topRight"
        })
    }

    if(serverMessage === "Your Default address has been Updated" ){
        iziToast.success({
            title : "Success",
            message :"Your Default address has been Updated",
            position : "topRight"
        })
    }


    feather.replace();

    function doesTheCountryHavePincode(country){
        console.log(country)
        const noPostalCodeCountries = ["AE", "HK", "MO", "QA", "OM", "SA"];
        const pincode = document.getElementById("pincode")
        if(noPostalCodeCountries.includes(country)){
           pincode.value = "Not Applicable"
            pincode.disabled = true
            iti.setCountry(country)
        }else{
            pincode.disabled = false
           pincode.value = ""
           iti.setCountry(country)
        }

    }
    
    function openAddAddressModal() {
       document.getElementById('addAddressModal').classList.remove('hidden');
       document.getElementById("accountName").classList.remove("hidden")
       document.getElementById("forAccountName").classList.remove("hidden")
       document.getElementById("defaultAddress").classList.remove("hidden")
       document.getElementById("forDefaultAddress").classList.remove("hidden")
       document.getElementById(`firstName`).value = ""
       document.getElementById(`lastName`).value = ""
       document.getElementById(`countryList`).value = ""
       document.getElementById(`state`).value = ""
       document.getElementById(`address`).value = ""
       document.getElementById(`pincode`).value = ""
       document.getElementById(`pincode`).disabled = false
       document.getElementById(`city`).value = ""
       document.getElementById(`phoneNumber`).value = ""
       window.intlTelInput(input, {
        utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js", // for formatting and validation
        initialCountry: "auto", // or a specific country code like "us"
        geoIpLookup: function(callback) { // optional: lookup user's country based on IP
            fetch("https://ipapi.co/json")
            .then(res => res.json())
            .then(data => {
                countryCode = data.country_calling_code
            return callback(data.country_code)
            })
            .catch(() => callback("us")); // default to US on error
        },
        })
       document.getElementById("addressFormHeading").innerText = "Add New Address"
       document.querySelector('#addAddressModal form').action = "/address"
    }
    
    function closeAddAddressModal() {
        document.getElementById('addAddressModal').classList.add('hidden');
    }

    function editAddress(index,id){
        document.querySelector('#addAddressModal form').action = `/address/edit-address?id=${id}`
        const noPostalCodeCountries = ["AE", "HK", "MO", "QA", "OM", "SA"];

       let editFirstName = document.getElementById(`firstName${index}`).innerText.trim()
       let editLastName = document.getElementById(`lastName${index}`).innerText.trim()
       let editCountry = document.getElementById(`country${index}`).innerText.trim()
       let editState = document.getElementById(`state${index}`).innerText.trim()
       let editAddress = document.getElementById(`address${index}`).innerText.trim()
       let editPincode = document.getElementById(`pincode${index}`).innerText.trim()
       let editMobileNo = document.getElementById(`mobileNo${index}`).innerText.trim()
       let editCity = document.getElementById(`city${index}`).innerText.trim()
       

       document.getElementById("accountName").classList.add("hidden")
       document.getElementById("forAccountName").classList.add("hidden")
       document.getElementById("defaultAddress").classList.add("hidden")
       document.getElementById("forDefaultAddress").classList.add("hidden")
       document.getElementById("addressFormHeading").innerText = "Edit Address"
       let editAddressModal = document.getElementById("addAddressModal")
       editAddressModal.classList.remove("hidden")
       iti.setNumber(editMobileNo)


       document.getElementById(`firstName`).value = editFirstName
       document.getElementById(`lastName`).value = editLastName
       document.getElementById(`countryList`).value = editCountry 
       document.getElementById(`state`).value = editState
       document.getElementById(`address`).value = editAddress
       document.getElementById(`pincode`).value = editPincode
       document.getElementById(`phoneNumber`).value = editMobileNo
       document.getElementById(`city`).value = editCity
       if (noPostalCodeCountries.includes(editCountry)) {
        document.getElementById('pincode').disabled = true
       }
    }

    function deleteAddress(addressId,userId){
        iziToast.question({
            theme : "dark",
            title : "Delete Address",
            message : "Are you sure you want to delete the Address ?",
            position : "topCenter",
            overlay : true,
            close : false,
            id : "deleteAddress",
            zindex : 9999,
            timeout : 30000,
            backgroundColor : "#242424", 
            buttons : [
                ["<button>OK</button>",function(instance,toast){
                    instance.hide({transitionOut : "fadeOut"},toast,'button')

                    fetch(`/address/delete-address?id=${addressId}&userId=${userId}`,{method : "DELETE"})
                    .then(res => window.location.href = "/address" )
                    .catch(error => iziToast.error({
                        title : error.name ,
                        message : error.message,
                        position : "topRight"
                    }))

                }],
                ["<button>Cancel</button>",function(instance,toast){
                    instance.hide({transitionOut : "fadeOut"},toast,'button')
                    console.log("Deletion Cancelled")
                }]
            ]
        })
    }
    function changeDefaultAddress(addressId){
        
        iziToast.question({
            theme : "dark",
            title : "Delete Address",
            message : "Are you sure you want to set this address as your Default Address?",
            position : "topCenter",
            overlay : true,
            close : false,
            id : "deleteAddress",
            zindex : 9999,
            timeout : 30000,
            backgroundColor : "#242424", 
            buttons : [
                ["<button>OK</button>",function(instance,toast){
                    instance.hide({transitionOut : "fadeOut"},toast,'button')

                    fetch(`/address/reset-default-address?id=${addressId}`,{method : "PATCH"})
                    .then(res => window.location.href = "/address" )
                    .catch(error => iziToast.error({
                        title : error.name ,
                        message : error.message,
                        position : "topRight"
                    }))

                }],
                ["<button>Cancel</button>",function(instance,toast){
                    instance.hide({transitionOut : "fadeOut"},toast,'button')
                    console.log("Deletion Cancelled")
                }]
            ]
        })
    }

    document.getElementById("accountName").addEventListener("click", function() {
        let useSameName = document.getElementById("accountName")
        let firstName = '<%- user.firstName %>'
        let lastName = '<%- user.lastName %>'
        if(useSameName.checked === true){
            document.getElementById("firstName").value = firstName
            document.getElementById("lastName").value = lastName
            console.log(iti.getNumber())
        }else{
            document.getElementById("firstName").value = ""
            document.getElementById("lastName").value = ""
        }
    })
    
    // Form submission would go here
    document.querySelector('#addAddressModal form').addEventListener('submit',function (e){
    const firstName = document.getElementById("firstName").value.trim()
    const lastName = document.getElementById("lastName").value.trim()
    const city = document.getElementById("city").value.trim()
    const state = document.getElementById("state").value.trim()
    const country = document.getElementById("countryList").value
    const pincode = document.getElementById("pincode").value.trim()
    const mobileNo = document.getElementById("phoneNumber")
    const address = document.getElementById("address").value.trim()
    const defaultAddress = document.getElementById("defaultAddress")


        const nameRegex =/^[A-Za-z]+(?:[ '-][A-Za-z]+)*(?:\d{0,5})?$/
        const addressRegex = /^[A-Za-z0-9 ,./-]{5,}$/
        const noPostalCodeCountries = ["AE", "HK", "MO", "QA", "OM", "SA"];

        if(!nameRegex.test(firstName)){
            iziToast.error({
                title : "Error",
                message : "Please enter a valid First Name",
                position : "topRight"
            })
            e.preventDefault()
            return 
        }

        if(!nameRegex.test(lastName)){
            iziToast.error({
                title : "Error",
                message : "Please enter a valid Last Name",
                position : "topRight"
            })
            e.preventDefault()
            return 
        }

        if(!nameRegex.test(city)){
            iziToast.error({
                title : "Error",
                message : "Please enter a valid City Name",
                position : "topRight"
            })
            e.preventDefault()
            return 
        }

        if(!nameRegex.test(state)){
            iziToast.error({
                title : "Error",
                message : "Please enter a valid State",
                position : "topRight"
            })
            e.preventDefault()
            return 
        }
        if(country === ""){
            iziToast.error({
                title : "Error",
                message : "Please select a Country",
                position : "topRight"
            })
            e.preventDefault()
            return 
        }

        if(!noPostalCodeCountries.includes(country)){
            if(pincode === ""){
                iziToast.error({
                title : "Error",
                message : "Please enter a valid Pincode",
                position : "topRight"
            })
            e.preventDefault()
            return 
            }else if(!validator.isPostalCode(pincode,country)){
                iziToast.error({
                title : "Error",
                message : "Invalid Pincode for the selected Country",
                position : "topRight"
            })
            e.preventDefault()
            return 
            }
        }

        
        if(!addressRegex.test(address)){
            iziToast.error({
                title : "Error",
                message : "Please enter a valid Address",
                position : "topRight"
            })
            e.preventDefault()
            return 
        }

        if(defaultAddress.checked){
            defaultAddress.value = true
        }else{
            defaultAddress.checked
            defaultAddress.value = false
        }

        if(mobileNo.value === ""){
            e.preventDefault()
            iziToast.error({
                title : "Error",
                message : "Please enter a Mobile Number",
                position : "topRight"
            })
            return
        }
        
        mobileNo.value = iti.getNumber()
        document.getElementById("pincode").disabled = false
    });
    
</script>
